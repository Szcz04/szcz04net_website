<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Gallery</title>
    <link rel="icon" type="image/x-icon" href="assets/ico.ico">
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <header class="site-header">
      <nav class="topnav">
        <a href="index.html" aria-label="Start"><img src="assets/start.png" alt="Start"/></a>
        <a href="about.html" aria-label="About me"><img src="assets/about.png" alt="About me"/></a>
        <a href="gallery.html" class="active" aria-label="Gallery"><img src="assets/gallery.png" alt="Gallery"/></a>
        <a href="contact.html" aria-label="Contact"><img src="assets/contact.png" alt="Contact"/></a>
      </nav>
    </header>

    <main class="content gallery">
      <h1></h1>

      <!-- Visual Art Section -->
      <section class="gallery-section" id="visualArtSection">
        <h2>Visual Art</h2>

        <!-- Swipe Viewer -->
        <div class="swipe-viewer" id="swipeViewer">
          <div class="viewer-empty" id="viewerEmpty">
            <p>No images yet. Upload some to get started.</p>
          </div>
          <div class="viewer-content" id="viewerContent" style="display:none;">
            <div class="image-container">
              <img id="currentImage" src="" alt="Current image" />
            </div>
            <div class="image-description" id="imageDescription"></div>
            <div class="nav-arrows">
              <button class="nav-btn prev" id="prevBtn" aria-label="Previous image">‹</button>
              <button class="nav-btn next" id="nextBtn" aria-label="Next image">›</button>
            </div>
            <div class="image-indicator" id="imageIndicator"></div>
            <!-- Thumbnail grid: click a miniature to jump to that image -->
            <div class="thumbnail-grid" id="thumbnailGrid" aria-label="Thumbnails"></div>
          </div>
        </div>
      </section>

      <!-- tech Section -->
      <section class="gallery-section" id="techSection" style="display:none;">
        <h2>tech</h2>
        <div class="section-content">
          <p class="placeholder-text">Coming soon...</p>
        </div>
      </section>

      <!-- Music Section -->
      <section class="gallery-section" id="musicSection" style="display:none;">
        <h2>Music</h2>
        
        <!-- Music Player -->
        <div class="music-player" id="musicPlayer">
          <div class="player-empty" id="playerEmpty">
            <p>No music tracks yet. Add some to get started.</p>
          </div>
          <div class="player-content" id="playerContent" style="display:none;">
            <div class="track-info">
              <div class="track-title" id="trackTitle"></div>
              <div class="track-description" id="trackDescription"></div>
            </div>
            <div class="audio-controls">
              <audio id="audioPlayer" controls>
                <p>Your browser does not support HTML5 audio.</p>
              </audio>
            </div>
            <div class="track-nav">
              <button class="track-nav-btn prev" id="prevTrackBtn" aria-label="Previous track">‹ Prev</button>
              <button class="track-nav-btn next" id="nextTrackBtn" aria-label="Next track">Next ›</button>
            </div>
            <div class="track-list">
              <div class="track-list-header">Tracks</div>
              <div class="track-items" id="trackItems"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- Sidebar toggle for subsections -->
      <aside class="gallery-sidebar">
        <div class="sidebar-toggle">
          <button class="sidebar-tab active" data-section="visualArt">Visual Art</button>
          <button class="sidebar-tab" data-section="tech">tech</button>
          <button class="sidebar-tab" data-section="music">Music</button>
        </div>
      </aside>
    </main>

    <!-- Image Lightbox Modal -->
    <div id="lightboxModal" class="lightbox-modal">
      <div class="lightbox-content">
        <span class="lightbox-close">&times;</span>
        <img id="lightboxImage" class="lightbox-image" alt="Full resolution image">
        <div class="lightbox-description" id="lightboxDescription"></div>
        <div class="lightbox-navigation">
          <button id="lightboxPrev" class="lightbox-nav-btn">‹</button>
          <button id="lightboxNext" class="lightbox-nav-btn">›</button>
        </div>
      </div>
    </div>
  </body>
    <script src="js/margin-gif.js"></script>
    <script src="js/gallery.js"></script>
    <script src="js/music-player.js"></script>
    <script>
      // Gallery section switching via sidebar tabs with URL routing and persistent state
      document.addEventListener('DOMContentLoaded', function () {
        const tabs = document.querySelectorAll('.sidebar-tab');
        const sections = document.querySelectorAll('.gallery-section');
        const TAB_STATE_KEY = 'galleryActiveTab';

        // URL Hash routing and state management
        function initializeGallery() {
          const hash = window.location.hash;
          let activeTab = 'visualArt';
          let targetId = null;

          // Parse URL hash for deep linking
          if (hash) {
            if (hash.startsWith('#music-track-')) {
              activeTab = 'music';
              targetId = parseInt(hash.replace('#music-track-', ''));
            } else if (hash.startsWith('#visual-art-')) {
              activeTab = 'visualArt';
              targetId = parseInt(hash.replace('#visual-art-', ''));
            } else if (hash.startsWith('#tech-')) {
              activeTab = 'tech';
              targetId = parseInt(hash.replace('#tech-', ''));
            } else if (hash === '#music') {
              activeTab = 'music';
            } else if (hash === '#tech') {
              activeTab = 'tech';
            } else if (hash === '#visual-art') {
              activeTab = 'visualArt';
            }
          } else {
            // Restore from localStorage if no hash
            const saved = localStorage.getItem(TAB_STATE_KEY);
            if (saved) {
              activeTab = saved;
            }
          }

          // Set active tab
          setActiveTab(activeTab, targetId);
        }

        function setActiveTab(tabName, targetId = null) {
          // Update active tab
          tabs.forEach(tab => {
            tab.classList.toggle('active', tab.dataset.section === tabName);
          });

          // Show appropriate section
          sections.forEach(section => {
            section.style.display = section.id === (tabName + 'Section') ? 'block' : 'none';
          });

          // Save state to localStorage
          localStorage.setItem(TAB_STATE_KEY, tabName);

          // Update URL hash without triggering reload
          const hashMap = {
            'visualArt': '#visual-art',
            'music': '#music',
            'tech': '#tech'
          };
          
          let newHash = hashMap[tabName] || '#visual-art';
          if (targetId) {
            if (tabName === 'music') {
              newHash = `#music-track-${targetId}`;
            } else if (tabName === 'visualArt') {
              newHash = `#visual-art-${targetId}`;
            }
          }
          
          history.replaceState(null, null, newHash);

          // Handle specific content targeting
          if (targetId && tabName === 'music') {
            // Wait for music player to initialize
            setTimeout(() => {
              if (window.musicPlayer && window.musicPlayer.jumpToTrack) {
                window.musicPlayer.jumpToTrack(targetId);
              }
            }, 500);
          } else if (targetId && tabName === 'visualArt') {
            // Wait for gallery to initialize
            setTimeout(() => {
              if (window.gallery && window.gallery.jumpToImage) {
                window.gallery.jumpToImage(targetId);
              }
            }, 500);
          }
        }

        // Handle tab clicks
        tabs.forEach(tab => {
          tab.addEventListener('click', function () {
            const sectionName = this.dataset.section;
            setActiveTab(sectionName);
          });
        });

        // Handle browser back/forward
        window.addEventListener('hashchange', function () {
          initializeGallery();
        });

        // Initialize on load
        initializeGallery();
      });
    </script>
</html>
